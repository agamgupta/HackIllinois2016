<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Speech to Text</title>
  </head>
  <body>

    <p>
      Loaded!
    </p>
    <br><br>
    <p>
       enter language code:
    </p>
    <input type='text' placeholder='en' />

    <script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.0.0-beta1/jquery.min.js'></script>
    <script>
      // var waitingForText = false;
      var translatedText = '';
      var concatUrl = function(base, q, source, target){
        console.log(q);
        var url = base+'&q=';
        q_arr = q.split(' ');
        for (var i=0;i<q_arr.length;i++){
          url += q_arr[i];
          if (i < q_arr.length - 1){
            url += '%20';
          }
        }
        url += '&source='+source+'&target='+target;
        return url;
      }

      // window.setInterval(function(){
      while (true){


      var recognition = new webkitSpeechRecognition();
      // recognition.continuous = true;
      // recognition.interimResults = true;
      recognition.lang = $('input').val();
      recognition.start();
      recognition.onresult = function(event) {

        // console.log(event);
        //set flag back to false
        // $.post('https://heroku-node-waji.herokuapp.com/facedetect?faceDetectFlag=false',function(res){
        //   console.log('resetting faceDetectFlag');
        // });

        if ($('input').val() != 'en' && $('input').val() != ''){
          var translateUrl = concatUrl('https://www.googleapis.com/language/translate/v2?key=AIzaSyBfrsItManvAhTKiw7RaQJhG1pamN65b18', event.results[0][0].transcript, $('input').val(),'en');

          $.get(translateUrl,function(res){
            translatedText = res.data.translations[0].translatedText;
            // console.log('translated to: '+translatedText);
          });
        } else {
          translatedText = event.results[0][0].transcript;
        }
        //send text to server
        $.post('https://heroku-node-waji.herokuapp.com/text',
          {
            text: translatedText,
            success: function(res){
              // if (translatedText.split(" ").length > 1000){
              //   recognition.stop();
              //   console.log(recognition.results);
              // }
            }
          }
        );
        // var recognition = new webkitSpeechRecognition();
        // recognition.continuous = true;
        // recognition.interimResults = true;
        // recognition.lang = $('input').val();
        // recognition.start();
      }
    }
    // }, 7500);
      // console.log(res.faceDetectFlag+', language is '+recognition.lang);

      // window.setInterval(function(){
      //   $.get('https://heroku-node-waji.herokuapp.com/facedetect',function(res){
      //     // console.log(res.faceDetectFlag + ', type ' + typeof(res.faceDetectFlag));
      //     if (res.faceDetectFlag == 'true'){ //&& waitingForText == false){
      //
      //       // waitingForText = true;
      //     }
      //   });
      //
      // }, 2000, function(){
      //   recognition.onresult = function(){
      //     recognition = new webkitSpeechRecognition();
      //     recognition.continuous = true;
      //     recognition.interimResults = true;
      //   };
      // });

    </script>

  </body>
</html>
