<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Speech to Text</title>
  </head>
  <body>

    <p>
      Loaded!
    </p>

    <script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.0.0-beta1/jquery.min.js'></script>
    <script>
      var waitingForText = false;

      var recognition = new webkitSpeechRecognition();
      recognition.onresult = function(event) {
        // console.log(event);
        //set flag back to false
        $.post('https://heroku-node-waji.herokuapp.com/facedetect?faceDetectFlag=false',function(res){
          console.log(res);
        });
        //send text to server
        $.post('https://heroku-node-waji.herokuapp.com/text',
          {
            'text': event.results[0][0].transcript,
            'success': function(){
              console.log(event.results[0][0].transcript);
              waitingForText = false;
            }
          });
        }

      window.setInterval(function(){
        $.get('https://heroku-node-waji.herokuapp.com/facedetect',function(res){
          if (res.faceDetectFlag && !waitingForText){
            recognition.start();
            waitingForText = true;
          } else {
            console.log(res.faceDetectFlag);
          }
        });
      }, 2000);

    </script>

  </body>
</html>
