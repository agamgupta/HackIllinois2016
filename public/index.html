<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Speech to Text</title>
  </head>
  <body>

    <p>
      Loaded!
    </p>
    <br><br>
    <p>
       enter language code:
    </p>
    <input type='text' placeholder='en' />

    <script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.0.0-beta1/jquery.min.js'></script>
    <script>
      var waitingForText = false;

      var recognition = new webkitSpeechRecognition();
      recognition.onresult = function(event) {
        // console.log(event);
        //set flag back to false
        $.post('https://heroku-node-waji.herokuapp.com/facedetect?faceDetectFlag=false');
        //send text to server
        $.post('https://heroku-node-waji.herokuapp.com/text',
          {
            'text': event.results[0][0].transcript,
            'success': function(){
              console.log('you said '+event.results[0][0].transcript);
              waitingForText = false;
            }
          }
        );
      }

      listenFailureHandler = function(){
        //reset face detect
        $.post('https://heroku-node-waji.herokuapp.com/facedetect?faceDetectFlag=false');
        //send text to server
        $.post('https://heroku-node-waji.herokuapp.com/text',
          {
            'text': '',
            'success': function(){
              console.log('you said ');
              waitingForText = false;
            }
          }
        );
      }

      window.setInterval(function(){
        $.get('https://heroku-node-waji.herokuapp.com/facedetect',function(res){
          if (res.faceDetectFlag && !waitingForText){
            recognition.lang = $('input').val();
            console.log(res.faceDetectFlag+', language is '+recognition.lang);
            recognition.start();
            waitingForText = true;

            // window.setTimeout(function(){
            //   listenFailureHandler();
            // }, 2000);
          } else {
            console.log('faceDetectFlag is '+res.faceDetectFlag);
          }
        });
      }, 2000);

    </script>

  </body>
</html>
